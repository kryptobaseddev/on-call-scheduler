{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Edit Team</h1>

    <div class="card">
        <div class="card-body">
            <form action="{{ url_for('admin.edit_team', team_id=team.id) }}" method="POST">
                <div class="mb-3">
                    <label for="name" class="form-label">Team Name</label>
                    <input type="text" class="form-control" id="name" name="name" value="{{ team.name }}" required>
                </div>
                <div class="mb-3">
                    <label for="manager_id" class="form-label">Manager</label>
                    <select class="form-select" id="manager_id" name="manager_id">
                        <option value="">No Manager</option>
                        {% for manager in managers %}
                            <option value="{{ manager.id }}" {% if team.manager_id == manager.id %}selected{% endif %}>{{ manager.username }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label for="color" class="form-label">Team Color</label>
                    <div id="colorPalette" class="d-flex flex-wrap">
                        {% for color in available_colors %}
                        <div
                            class="color-option m-1 {% if color == team.color %}selected{% endif %}"
                            style="background-color: {{ color }};"
                            data-color="{{ color }}"
                        ></div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="color" name="color" value="{{ team.color }}" required />
                </div>
                <button type="submit" class="btn btn-primary">Update Team</button>
                <a href="{{ url_for('admin.manage_teams') }}" class="btn btn-secondary">Cancel</a>
            </form>
        </div>
    </div>
</div>

<style>
  .color-option {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
  }
  .color-option.selected {
    border-color: #000;
  }
  .color-option.used {
    opacity: 0.5;
    cursor: not-allowed;
  }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const colorOptions = document.querySelectorAll('.color-option');
        const colorInput = document.getElementById('color');
        const usedColors = new Set({{ used_colors|tojson }});
    
        colorOptions.forEach(option => {
            const color = option.dataset.color;
            if (usedColors.has(color) && color !== '{{ team.color }}') {
                option.classList.add('used');
            } else {
                option.addEventListener('click', function() {
                    if (!this.classList.contains('used')) {
                        colorOptions.forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        colorInput.value = color;
                    }
                });
            }
        });
    });
    </script>
{% endblock %}